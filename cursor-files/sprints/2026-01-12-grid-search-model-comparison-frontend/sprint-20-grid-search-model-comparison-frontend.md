# Sprint 20: Grid Search Model Comparison Frontend

**Date**: Mon Jan 12 07:05:28 PST 2026  
**Sprint Duration**: 2-3 days (11-15 hours total)  
**Sprint Goal**: Create a frontend page that compares multiple grid search results (ESPN + 4 ML models) side-by-side with visualizations, metrics, and export functionality. Users can view all 5 models in a unified interface with synchronized heatmaps, comparison tables, and export to HTML/image.  
**Current Status**: Grid search results exist individually in `data/grid_search/{cache_key}/` directories. Comparison script generates `data/grid_search/model_comparison.json`. No frontend exists to view comparisons.  
**Target Status**: New route `#/grid-search-comparison` displays all 5 models side-by-side with heatmaps, metrics tables, charts, and export functionality. HTML export saves to `docs/grid-search-comparison.html` for GitHub Pages.  
**Team Size**: 1 developer  
**Sprint Lead**: System Developer  

## Sprint Standards Reference

**Important**: This sprint follows the comprehensive standards defined in `SPRINT_STANDARDS.md`.

**Key Requirements**:
- **Evidence-Based**: Every claim backed by concrete evidence (code refs, file structure, existing patterns)
- **Run Context**: Based on existing grid search results in `data/grid_search/` and comparison data
- **File Verification**: All referenced files verified and examined
- **Design Patterns**: Document design patterns used (Template Method, Facade, Strategy)

**See `SPRINT_STANDARDS.md` for complete requirements and validation checklist.**

## Pre-Sprint Code Quality Baseline

- **Test Results**: N/A (frontend feature, no existing tests)
- **QC Results**: N/A (new feature)
- **Code Coverage**: N/A (new feature)
- **Build Status**: Webapp builds successfully, no errors

**Purpose**: This baseline ensures we maintain code quality throughout the sprint.

## Database Evidence Template

**Note**: This repo uses PostgreSQL via `DATABASE_URL`. This sprint does NOT modify the database - it only reads existing grid search result files.

## Git Usage Restrictions

**CRITICAL RESTRICTION**: Sprint participants must NOT use git at all unless explicitly directed.

**Git Usage Rules**:
- **NO git commands** unless explicitly mentioned in sprint plan
- **NO git operations** unless explicitly mentioned in analysis
- **NO version control** unless explicitly mentioned in prompt

## Sprint Overview

### Business Context
- **Business Driver**: Users need to compare grid search results across 5 different models (ESPN + 4 ML models) to identify the best performing model and optimal thresholds. Currently, users must manually compare results across different pages, which is time-consuming and error-prone.
- **Success Criteria**: 
  - Users can view all 5 models side-by-side in a single page
  - Users can export comparison view to HTML for GitHub Pages
  - Users can export comparison view as image for sharing
  - Page loads and renders within 2 seconds
- **Stakeholders**: Data scientists, traders, developers using grid search functionality
- **Timeline Constraints**: None

### Technical Context
- **Current System State**: 
  - Grid search results stored in `data/grid_search/{cache_key}/` directories
  - Comparison script generates `data/grid_search/model_comparison.json`
  - Individual grid search page exists at `#/grid-search` (shows single result)
  - Model comparison page exists at `#/model-comparison` (shows win probability models, different use case)
  - Export system exists: `/api/export/html` saves to `docs/` directory
- **Target System State**: 
  - New route `#/grid-search-comparison` displays comparison page
  - API endpoint `/api/grid-search/comparison` serves comparison data
  - Frontend template `grid-search-comparison.html` renders comparison view
  - JavaScript `grid-search-comparison.js` handles rendering and exports
  - HTML export saves to `docs/grid-search-comparison.html`
- **Architecture Impact**: Adds new page to existing SPA architecture, follows existing patterns
- **Integration Points**: 
  - Reads from `data/grid_search/model_comparison.json`
  - Reads from individual grid search result directories
  - Uses existing export API endpoint
  - Uses existing routing system

### Sprint Scope
- **In Scope**: 
  - API endpoint for comparison data
  - Frontend template and JavaScript
  - Routing and navigation
  - HTML and image export functionality
  - Side-by-side heatmap visualization
  - Metrics comparison table
  - Chart visualizations (marginal effects, tradeoff scatter)
- **Out of Scope**: 
  - Database modifications
  - Backend grid search logic changes
  - Individual grid search page modifications
  - Model training or evaluation
- **Assumptions**: 
  - `data/grid_search/model_comparison.json` exists (generated by comparison script)
  - Individual grid search result directories exist
  - Existing export system works correctly
  - html2canvas library is available (already included in `index.html`)
- **Constraints**: 
  - Must follow existing code patterns and design
  - Must maintain performance (< 2 second load time)
  - Must work on desktop and mobile (responsive design)

## Sprint Phases

### Phase 1: API Endpoint (Duration: 2-3 hours)
**Objective**: Create API endpoint that serves comparison data and visualization data for all models
**Dependencies**: Existing grid search results in `data/grid_search/`, comparison script must have run
**Deliverables**: API endpoint `/api/grid-search/comparison` returns JSON with comparison data

### Phase 2: Frontend Template (Duration: 2-3 hours)
**Objective**: Create HTML template for comparison page with proper structure and styling
**Dependencies**: Phase 1 complete (API endpoint available for testing)
**Deliverables**: Template file `grid-search-comparison.html` renders correctly

### Phase 3: Frontend JavaScript (Duration: 4-6 hours)
**Objective**: Implement comparison page logic including data loading, rendering, and exports
**Dependencies**: Phase 1 and Phase 2 complete
**Deliverables**: JavaScript file `grid-search-comparison.js` with all functionality working

### Phase 4: Routing and Navigation (Duration: 30 minutes)
**Objective**: Add route handler and navigation link for comparison page
**Dependencies**: Phase 2 and Phase 3 complete
**Deliverables**: Navigation works, page loads when navigating to `#/grid-search-comparison`

### Phase 5: Sprint Quality Assurance (Duration: 2-3 hours) [MANDATORY]
**Objective**: Test all functionality, validate quality standards, update documentation
**Dependencies**: Must complete Phase 4 successfully
**Deliverables**: All tests pass, documentation updated, quality gates met

## Sprint Backlog

### Epic 1: API Endpoint for Comparison Data
**Priority**: Critical (required for frontend to function)
**Estimated Time**: 2-3 hours
**Dependencies**: None (reads existing files)
**Status**: Not Started
**Phase Assignment**: Phase 1

### Story 1.1: Create Comparison API Endpoint
- **ID**: S20-E1-S1
- **Type**: Feature
- **Priority**: Critical (required for frontend)
- **Estimate**: 2-3 hours
- **Phase**: 1
- **Prerequisites**: None
- **Files to Modify**: `webapp/api/endpoints/grid_search.py`
- **Files to Create**: None
- **Dependencies**: Python standard library (json, pathlib), existing grid_search.py structure

- **Acceptance Criteria**:
  - [ ] Endpoint `GET /api/grid-search/comparison` exists in `grid_search.py`
  - [ ] Endpoint reads `data/grid_search/model_comparison.json` successfully
  - [ ] Endpoint loads visualization data from each model's result directory
  - [ ] Endpoint returns JSON with structure: `{ models: [...], visualization_data: {...} }`
  - [ ] Endpoint handles missing files gracefully (returns error message)
  - [ ] Endpoint response time < 500ms
  - [ ] Endpoint returns 200 status code on success
  - [ ] Endpoint returns 404/500 status code on error with error message

- **Technical Context**:
  - **Current State**: No comparison endpoint exists. Individual grid search results are served via `/api/grid-search/results/{request_id}`.
  - **Target State**: New endpoint reads comparison JSON and individual result files, transforms into unified format for frontend.
  
  **Implementation Steps**:
  1. Add function `get_grid_search_comparison() -> dict[str, Any]` to `grid_search.py`
  2. Read `data/grid_search/model_comparison.json` using `Path` and `json.load()`
  3. For each model in comparison data:
     - Load `grid_results_train.json` from model's result directory
     - Load `grid_results_valid.json` from model's result directory
     - Extract visualization data (heatmap matrices, scatter data, marginal effects)
  4. Transform data into unified format:
     ```python
     {
       "models": [
         {
           "model_name": "ESPN (default)",
           "result_dir": "...",
           "test_metrics": {...},
           "valid_metrics": {...},
           "train_metrics": {...},
           "chosen_params": {...}
         },
         ...
       ],
       "visualization_data": {
         "heatmaps": {
           "train": {...},  # Matrices for all models
           "valid": {...}
         },
         "marginal_effects": {...},
         "tradeoff_scatter": {...}
       }
     }
     ```
  5. Add route decorator: `@router.get("/api/grid-search/comparison")`
  6. Add error handling for missing files, invalid JSON
  7. Return JSON response

- **Design Pattern**: Facade Pattern - provides unified interface to multiple data sources
- **Algorithm**: O(n √ó m) where n = models (5), m = data files per model (2-3)
- **Big O Complexity**: O(n √ó m) - linear in number of models and files

### Epic 2: Frontend Template
**Priority**: Critical (required for UI)
**Estimated Time**: 2-3 hours
**Dependencies**: Epic 1 (for testing, but can be developed in parallel)
**Status**: Not Started
**Phase Assignment**: Phase 2

### Story 2.1: Create Comparison Page Template
- **ID**: S20-E2-S1
- **Type**: Feature
- **Priority**: Critical (required for UI)
- **Estimate**: 2-3 hours
- **Phase**: 2
- **Prerequisites**: None (can reference existing templates)
- **Files to Create**: `webapp/static/templates/grid-search-comparison.html`
- **Files to Modify**: `webapp/static/css/styles.css` (add comparison-specific styles if needed)
- **Dependencies**: Existing CSS styles, HTML structure patterns

- **Acceptance Criteria**:
  - [ ] Template file exists at `webapp/static/templates/grid-search-comparison.html`
  - [ ] Template includes page header with title "Grid Search Model Comparison"
  - [ ] Template includes export buttons (Export HTML, Export Image)
  - [ ] Template includes summary section with ID `comparisonSummary`
  - [ ] Template includes heatmaps section with ID `comparisonHeatmaps` and grid container `heatmapGrid`
  - [ ] Template includes detailed metrics section with ID `detailedMetrics`
  - [ ] Template includes charts section with ID `comparisonCharts`
  - [ ] Template uses consistent styling with existing pages (matches `grid-search.html` style)
  - [ ] Template includes responsive CSS Grid layout (5 columns desktop, 3 tablet, 2 mobile)
  - [ ] Template renders correctly when loaded in browser

- **Technical Context**:
  - **Current State**: No comparison template exists. Reference templates: `grid-search.html`, `model-comparison.html`
  - **Target State**: Template with structure for 5-model comparison, follows existing design patterns
  
  **Implementation Steps**:
  1. Create template file following structure of `model-comparison.html`
  2. Add page header with title and export buttons:
     ```html
     <div class="page-header">
       <div>
         <h2>Grid Search Model Comparison</h2>
         <p class="page-header-subtitle">Compare ESPN and 4 ML models side-by-side</p>
       </div>
       <div class="export-buttons">
         <button class="export-btn" onclick="exportComparisonToHTML()">üìÑ Export HTML</button>
         <button class="export-btn" onclick="exportComparisonToImage()">üñºÔ∏è Export Image</button>
       </div>
     </div>
     ```
  3. Add summary section with table container:
     ```html
     <div id="comparisonSummary" class="results-section">
       <h3>Summary Comparison</h3>
       <div id="summaryTable"></div>
     </div>
     ```
  4. Add heatmaps section with grid layout:
     ```html
     <div id="comparisonHeatmaps" class="results-section">
       <h3>Profit Heatmaps (Validation Set)</h3>
       <div id="heatmapGrid" class="heatmap-grid"></div>
     </div>
     ```
  5. Add detailed metrics section:
     ```html
     <div id="detailedMetrics" class="results-section">
       <h3>Detailed Metrics by Model</h3>
       <div id="detailedMetricsContent"></div>
     </div>
     ```
  6. Add charts section:
     ```html
     <div id="comparisonCharts" class="results-section">
       <h3>Additional Visualizations</h3>
       <div id="chartsGrid"></div>
     </div>
     ```
  7. Add CSS for grid layout (in template or styles.css):
     ```css
     .heatmap-grid {
       display: grid;
       grid-template-columns: repeat(5, 1fr);
       gap: 1rem;
     }
     @media (max-width: 1200px) {
       .heatmap-grid { grid-template-columns: repeat(3, 1fr); }
     }
     @media (max-width: 768px) {
       .heatmap-grid { grid-template-columns: repeat(2, 1fr); }
     }
     ```

- **Design Pattern**: Template Method Pattern - follows existing template structure
- **Algorithm**: O(1) - static HTML structure
- **Big O Complexity**: O(1) - constant time rendering

### Epic 3: Frontend JavaScript
**Priority**: Critical (required for functionality)
**Estimated Time**: 4-6 hours
**Dependencies**: Epic 1 (API endpoint), Epic 2 (template)
**Status**: Not Started
**Phase Assignment**: Phase 3

### Story 3.1: Implement Data Loading and Summary Table
- **ID**: S20-E3-S1
- **Type**: Feature
- **Priority**: Critical (core functionality)
- **Estimate**: 1-2 hours
- **Phase**: 3
- **Prerequisites**: S20-E1-S1 (API endpoint), S20-E2-S1 (template)
- **Files to Create**: `webapp/static/js/grid-search-comparison.js`
- **Files to Modify**: None
- **Dependencies**: Fetch API, existing grid-search.js patterns

- **Acceptance Criteria**:
  - [ ] Function `loadGridSearchComparison()` exists and fetches from `/api/grid-search/comparison`
  - [ ] Function `renderComparisonSummary()` exists and renders metrics table
  - [ ] Summary table shows: Model, Test Profit, Trades, Win Rate, Entry, Exit, Profit/Trade
  - [ ] Summary table includes improvement percentages vs baseline (ESPN)
  - [ ] Summary table formats currency values correctly ($X,XXX.XX)
  - [ ] Summary table formats percentages correctly (XX.X%)
  - [ ] Summary table highlights best/worst values
  - [ ] Error handling displays user-friendly message if API fails
  - [ ] Loading indicator shows while fetching data

- **Technical Context**:
  - **Current State**: No comparison JavaScript exists. Reference: `model-comparison.js` for data loading pattern
  - **Target State**: Loads comparison data, renders summary table with all metrics
  
  **Implementation Steps**:
  1. Create `grid-search-comparison.js` file
  2. Implement `loadGridSearchComparison()`:
     ```javascript
     async function loadGridSearchComparison() {
       const container = document.getElementById('comparisonSummary');
       container.innerHTML = '<div class="loading">Loading comparison...</div>';
       
       try {
         const response = await fetch('/api/grid-search/comparison');
         if (!response.ok) throw new Error(`HTTP ${response.status}`);
         const data = await response.json();
         renderComparisonSummary(data);
       } catch (error) {
         container.innerHTML = `<div class="error">Error: ${error.message}</div>`;
       }
     }
     ```
  3. Implement `renderComparisonSummary(data)`:
     - Extract models from data
     - Find baseline (ESPN model)
     - Build HTML table with columns: Model, Test Profit, Trades, Win Rate, Entry, Exit, Profit/Trade, Improvement
     - Calculate improvement percentages: `((profit - baseline) / baseline) * 100`
     - Format values: currency, percentages, thresholds
     - Insert into `#summaryTable` element

- **Design Pattern**: Module Pattern - encapsulates comparison functionality
- **Algorithm**: O(n) where n = number of models (5)
- **Big O Complexity**: O(n) - linear in number of models

### Story 3.2: Implement Heatmap Rendering
- **ID**: S20-E3-S2
- **Type**: Feature
- **Priority**: Critical (core visualization)
- **Estimate**: 2-3 hours
- **Phase**: 3
- **Prerequisites**: S20-E3-S1 (data loading)
- **Files to Modify**: `webapp/static/js/grid-search-comparison.js`
- **Files to Create**: None
- **Dependencies**: Canvas API, existing `renderProfitHeatmap()` from `grid-search.js`

- **Acceptance Criteria**:
  - [ ] Function `renderComparisonHeatmaps()` exists
  - [ ] Function calculates global min/max across all models
  - [ ] Function renders 5 heatmaps side-by-side in grid layout
  - [ ] All heatmaps use same color scale (synchronized)
  - [ ] Each heatmap is labeled with model name
  - [ ] Heatmaps render on canvas elements (800√ó600 pixels)
  - [ ] Heatmaps use RdYlGn color scheme (red-yellow-green)
  - [ ] Heatmaps include axis labels (entry threshold, exit threshold)
  - [ ] Heatmaps render within 1 second for all 5 models

- **Technical Context**:
  - **Current State**: `grid-search.js` has `renderProfitHeatmap()` for single heatmap. Need to adapt for 5 heatmaps with synchronized scales.
  - **Target State**: Renders 5 heatmaps in grid, all using same color scale
  
  **Implementation Steps**:
  1. Implement `calculateGlobalScale(allHeatmapData)`:
     ```javascript
     function calculateGlobalScale(allHeatmapData) {
       let globalMin = Infinity, globalMax = -Infinity;
       allHeatmapData.forEach(modelData => {
         modelData.matrix.forEach(row => {
           row.forEach(val => {
             if (val !== null && val !== undefined) {
               globalMin = Math.min(globalMin, val);
               globalMax = Math.max(globalMax, val);
             }
           });
         });
       });
       return { min: globalMin, max: globalMax };
     }
     ```
  2. Implement `renderComparisonHeatmaps(data)`:
     - Extract heatmap data for all models from API response
     - Calculate global scale using `calculateGlobalScale()`
     - Create canvas elements for each model (dynamically or in template)
     - For each model:
       - Get canvas element by model name or index
       - Call `renderProfitHeatmap()` with model data and global scale
       - Add model name label above canvas
     - Insert canvases into `#heatmapGrid` container
  3. Reuse `renderProfitHeatmap()` from `grid-search.js`:
     - Copy function or import if possible
     - Modify to accept global scale parameter
     - Ensure color mapping uses global scale

- **Design Pattern**: Strategy Pattern - different rendering strategies for different visualization types
- **Algorithm**: O(n √ó w √ó h) where n = models (5), w = entry thresholds, h = exit thresholds
- **Big O Complexity**: O(n √ó w √ó h) - linear in models and heatmap dimensions

### Story 3.3: Implement Chart Rendering
- **ID**: S20-E3-S3
- **Type**: Feature
- **Priority**: Medium (additional visualization)
- **Estimate**: 1-2 hours
- **Phase**: 3
- **Prerequisites**: S20-E3-S1 (data loading)
- **Files to Modify**: `webapp/static/js/grid-search-comparison.js`
- **Files to Create**: None
- **Dependencies**: Chart.js (already included), existing chart rendering from `grid-search.js`

- **Acceptance Criteria**:
  - [ ] Function `renderComparisonCharts()` exists
  - [ ] Function renders marginal effects chart with all 5 models
  - [ ] Function renders tradeoff scatter plot with all 5 models
  - [ ] Each model uses distinct color in charts
  - [ ] Charts include legend with model names
  - [ ] Charts are responsive (resize with container)
  - [ ] Charts render within 500ms

- **Technical Context**:
  - **Current State**: `grid-search.js` has chart rendering for single model. Need to adapt for multiple models on same chart.
  - **Target State**: Charts show all 5 models with different colors
  
  **Implementation Steps**:
  1. Implement `renderComparisonCharts(data)`:
     - Extract chart data (marginal effects, tradeoff scatter) from API response
     - Create Chart.js datasets for each model with distinct colors
     - Render marginal effects chart (line chart with 5 datasets)
     - Render tradeoff scatter plot (scatter chart with 5 datasets)
     - Insert charts into `#chartsGrid` container
  2. Define color palette for models:
     ```javascript
     const modelColors = {
       'ESPN (default)': '#7c3aed',
       'logreg_platt': '#ef4444',
       'logreg_isotonic': '#f59e0b',
       'catboost_platt': '#10b981',
       'catboost_isotonic': '#3b82f6'
     };
     ```
  3. Reuse chart rendering logic from `grid-search.js`:
     - Adapt `renderMarginalEffects()` for multiple models
     - Adapt `renderTradeoffScatter()` for multiple models

- **Design Pattern**: Strategy Pattern - different chart types use different rendering strategies
- **Algorithm**: O(n √ó d) where n = models (5), d = data points per model
- **Big O Complexity**: O(n √ó d) - linear in models and data points

### Story 3.4: Implement Export Functionality
- **ID**: S20-E3-S4
- **Type**: Feature
- **Priority**: High (required feature)
- **Estimate**: 1-2 hours
- **Phase**: 3
- **Prerequisites**: S20-E3-S1, S20-E3-S2, S20-E3-S3 (all rendering complete)
- **Files to Modify**: `webapp/static/js/grid-search-comparison.js`
- **Files to Create**: None
- **Dependencies**: html2canvas (already included), `/api/export/html` endpoint, `export-utils.js`

- **Acceptance Criteria**:
  - [ ] Function `exportComparisonToHTML()` exists
  - [ ] Function fetches CSS from `/static/css/styles.css`
  - [ ] Function embeds comparison data in script tag
  - [ ] Function generates complete HTML with embedded data
  - [ ] Function POSTs to `/api/export/html` with filename `grid-search-comparison.html`
  - [ ] Function shows success message or logs to console
  - [ ] Function `exportComparisonToImage()` exists
  - [ ] Function uses html2canvas to capture comparison view
  - [ ] Function downloads image as PNG file
  - [ ] Image export includes all visualizations and tables
  - [ ] HTML export renders correctly when opened in browser (standalone)

- **Technical Context**:
  - **Current State**: `model-comparison.js` has export functions. Can reuse pattern.
  - **Target State**: Both HTML and image export work correctly
  
  **Implementation Steps**:
  1. Implement `exportComparisonToHTML()`:
     - Fetch CSS: `await fetch('/static/css/styles.css').then(r => r.text())`
     - Get container HTML: `document.getElementById('gridSearchComparisonView').innerHTML`
     - Embed comparison data in script tag:
       ```javascript
       const chartInitCode = `
         <script>
           const comparisonData = ${JSON.stringify(comparisonData, null, 2)};
           // Initialize charts when page loads
           window.addEventListener('load', function() {
             // Chart initialization code
           });
         </script>
       `;
       ```
     - Generate complete HTML with header (use `generateExportHeader()` from `export-utils.js`)
     - POST to `/api/export/html`:
       ```javascript
       await fetch('/api/export/html', {
         method: 'POST',
         headers: { 'Content-Type': 'application/json' },
         body: JSON.stringify({
           html_content: htmlContent,
           filename: 'grid-search-comparison.html'
         })
       });
       ```
  2. Implement `exportComparisonToImage()`:
     - Get container: `document.getElementById('gridSearchComparisonView')`
     - Use html2canvas:
       ```javascript
       const canvas = await html2canvas(container, {
         backgroundColor: '#0a0a0f',
         scale: 2,
         logging: false
       });
       ```
     - Convert to blob and download:
       ```javascript
       canvas.toBlob((blob) => {
         const url = URL.createObjectURL(blob);
         const a = document.createElement('a');
         a.href = url;
         a.download = `grid-search-comparison-${dateStr}.png`;
         a.click();
       }, 'image/png');
       ```

- **Design Pattern**: Facade Pattern - unified export interface
- **Algorithm**: O(c) where c = HTML content size (HTML export), O(p) where p = pixels (image export)
- **Big O Complexity**: O(c) for HTML, O(p) for image

### Epic 4: Routing and Navigation
**Priority**: High (required for access)
**Estimated Time**: 30 minutes
**Dependencies**: Epic 2 (template), Epic 3 (JavaScript)
**Status**: Not Started
**Phase Assignment**: Phase 4

### Story 4.1: Add Route and Navigation Link
- **ID**: S20-E4-S1
- **Type**: Configuration
- **Priority**: High (required for access)
- **Estimate**: 30 minutes
- **Phase**: 4
- **Prerequisites**: S20-E2-S1 (template), S20-E3-S1 (JavaScript)
- **Files to Modify**: `webapp/static/js/routing.js`, `webapp/static/index.html`, `webapp/static/js/app.js` (if needed)
- **Files to Create**: None
- **Dependencies**: Existing routing system

- **Acceptance Criteria**:
  - [ ] Route handler exists for `#/grid-search-comparison` in `routing.js`
  - [ ] Navigation link exists in `index.html` header nav
  - [ ] Navigation link has icon and text "Grid Search Comparison"
  - [ ] Clicking navigation link loads comparison page
  - [ ] Comparison page initializes and loads data when navigated to
  - [ ] Active navigation link is highlighted when on comparison page
  - [ ] Script tag for `grid-search-comparison.js` exists in `index.html`

- **Technical Context**:
  - **Current State**: Routing system exists in `routing.js`. Navigation links in `index.html`. Template loading in `templates.js`.
  - **Target State**: New route works, navigation link added, page loads correctly
  
  **Implementation Steps**:
  1. Update `routing.js`:
     - Add route handler in `getRoute()`:
       ```javascript
       if (hash === '/grid-search-comparison' || hash.startsWith('/grid-search-comparison')) {
         return { view: 'grid-search-comparison', gameId: null };
       }
     ```
     - Update `updateActiveNav()` to handle new route
  2. Update `index.html`:
     - Add navigation link:
       ```html
       <a href="#/grid-search-comparison" class="nav-link" data-route="grid-search-comparison">
         <span class="nav-icon">üìä</span>
         <span class="nav-text">Grid Search Comparison</span>
       </a>
       ```
     - Add script tag:
       ```html
       <script src="/static/js/grid-search-comparison.js"></script>
       ```
  3. Update `app.js` (if needed):
     - Add view initialization for `grid-search-comparison`
     - Call `loadGridSearchComparison()` when view loads

- **Design Pattern**: Router Pattern - follows existing routing pattern
- **Algorithm**: O(1) - constant time route lookup
- **Big O Complexity**: O(1) - constant time

### Epic 5: Quality Assurance and Testing
**Priority**: Critical (ensures quality)
**Estimated Time**: 2-3 hours
**Dependencies**: All previous epics
**Status**: Not Started
**Phase Assignment**: Phase 5

### Story 5.1: Functional Testing
- **ID**: S20-E5-S1
- **Type**: Testing
- **Priority**: Critical (ensures functionality)
- **Estimate**: 1-2 hours
- **Phase**: 5
- **Prerequisites**: All previous stories complete
- **Files to Modify**: None
- **Files to Create**: None
- **Dependencies**: Browser, existing grid search results

- **Acceptance Criteria**:
  - [ ] Navigate to `#/grid-search-comparison` - page loads without errors
  - [ ] API endpoint `/api/grid-search/comparison` returns data successfully
  - [ ] Summary table renders with all 5 models
  - [ ] Heatmaps render correctly (5 heatmaps visible)
  - [ ] Charts render correctly (marginal effects, tradeoff scatter)
  - [ ] Export HTML button works - file saved to `docs/grid-search-comparison.html`
  - [ ] Export image button works - image downloads
  - [ ] Exported HTML opens in browser and renders correctly
  - [ ] Page loads within 2 seconds
  - [ ] Visualizations render within 2 seconds
  - [ ] Responsive design works on mobile (test viewport < 768px)

- **Technical Context**:
  - **Testing Approach**: Manual testing in browser
  - **Test Cases**:
    1. Navigate to comparison page
    2. Verify data loads
    3. Verify all visualizations render
    4. Test export functionality
    5. Test responsive design
    6. Test error handling (missing data)

### Story 5.2: Documentation Update
- **ID**: S20-E5-S2
- **Type**: Documentation
- **Priority**: Medium (improves maintainability)
- **Estimate**: 1 hour
- **Phase**: 5
- **Prerequisites**: All previous stories complete
- **Files to Modify**: `README.md` (if needed), `docs/GITHUB_PAGES_DEPLOYMENT.md` (if needed)
- **Files to Create**: None
- **Dependencies**: None

- **Acceptance Criteria**:
  - [ ] README.md updated with comparison page information (if needed)
  - [ ] GitHub Pages deployment guide updated with comparison page export (if needed)
  - [ ] Code comments added to JavaScript functions
  - [ ] API endpoint documented with docstring

- **Technical Context**:
  - **Documentation Needs**: 
    - How to access comparison page
    - How to export comparison view
    - API endpoint documentation

## Risk Mitigation

### Technical Risks

**Risk 1**: Large visualization data causes slow page load
- **Mitigation**: Lazy load visualizations, compress data, show loading indicators
- **Contingency**: Progressive rendering, simplified view option

**Risk 2**: html2canvas fails on large comparison view
- **Mitigation**: Test with actual data, use lower scale, split if needed
- **Contingency**: Alternative export method, screenshot instructions

**Risk 3**: Heatmap rendering performance issues
- **Mitigation**: Optimize canvas rendering, reduce canvas size, cache rendered heatmaps
- **Contingency**: Simplified heatmaps, Chart.js heatmap plugin

### Data Risks

**Risk 1**: Missing comparison data
- **Mitigation**: Check for file existence, show helpful error message, provide instructions
- **Contingency**: Graceful error handling, fallback to empty state

**Risk 2**: Inconsistent data formats
- **Mitigation**: Validate data structure, handle missing fields gracefully, log errors
- **Contingency**: Show partial data, log errors for debugging

## Success Metrics

- **Functionality**: All features work as specified
- **Performance**: Page loads < 2 seconds, visualizations render < 2 seconds
- **User Experience**: Intuitive interface, clear visualizations, easy exports
- **Code Quality**: Follows existing patterns, well-documented, no errors
- **Export Quality**: HTML and image exports work correctly, exported HTML renders standalone

## Definition of Done

- [ ] All stories completed and tested
- [ ] API endpoint returns correct data
- [ ] Frontend renders all visualizations correctly
- [ ] Export functionality works (HTML and image)
- [ ] Navigation works correctly
- [ ] Responsive design works on mobile
- [ ] Code follows existing patterns
- [ ] Documentation updated
- [ ] No console errors
- [ ] Performance meets targets (< 2 seconds load time)

